// TODO

1) for some reason sometimes these errors are logged (but everything appears to be fine):
downloading 02 Beamer
writing cue sheet for 02 Beamer
downloading artwork for 02 Beamer
will not embed artwork, saving for later processing.
transferring 02 Beamer to media centre
destination directory located on this machine, using mv

mv: cannot stat '/home/barnsbury/projects/patreon-downloader/files/0002_Beamer.wav': No such file or directory

exec error: Error: Command failed: "/home/barnsbury/projects/patreon-downloader/bin/process-wav.sh" "https://c10.patreonusercontent.com/3/eyJwIjoxfQ%3D%3D/patreon-media/p/post/24393271/1efa5572402144e3af20589213e4ba8c/1.wav?token-time=1562544000&token-hash=Nht4fzgXVUbhtLgTFG_2rJAJPiG1jsVApmeqs6jUq7s%3D&ext=.wav" "/home/barnsbury/projects/patreon-downloader/files/0002_Beamer.wav" "Track two of What's Wrong With You (First Draft). WAV for downloading

Charlottefield, First Draft, What's Wrong With You" 2019 "02 Beamer" "https://c10.patreonusercontent.com/3/eyJoIjo1MTgsInciOjkyMH0%3D/patreon-media/p/post/24393271/ed5b2c34fa2e480f82bdf28b286f72ad/1.jpg?token-time=1562544000&token-hash=uSTRLSI5gQBGXcfroraN8rAs_i4WzJxyLKqaS1hex9Y%3D" "T House"
mv: cannot stat '/home/barnsbury/projects/patreon-downloader/files/0002_Beamer.wav': No such file or directory
--

* FIX (2)

// GitHub issues!
1. Not sure whether it is different for other artists or whether patreon has changed the HTML layout, but the link detection here does not work any more: https://github.com/endofhome/patreon-downloader/blob/master/bin/patreon-downloader.js#L24

   Files are not tagged post-file-download unfortunately. I could get it to work by using a[href^="https://www.patreon.com/file"] as selector instead.

- I only use this with one particular creator on Patreon, but for all of their downloadable content, post-file-download still works fine for me. I'd like to understand the problem better. Could you please send me a link to a relevant Patreon post?

✅curl call here: https://github.com/endofhome/patreon-downloader/blob/master/bin/download-mp3.sh#L17 should have -L set because patreon usually answers with a redirect to the CDN

- I haven't run into this issue at all - but I don't see the harm in updating the cURL call.

3. For many downloads to work, this curl call here: https://github.com/endofhome/patreon-downloader/blob/master/bin/download-mp3.sh#L17 also has to have the session_id cookie set or it will return HTTP 403

- This hasn't been the case in my experience - I'm not sure why. I don't see the harm in adding the session_id cookie here so will make the change, but I'd like to understand why. Could you please send me a link to a relevant Patreon post?


✅ Required file downloaded.txt does not exist

// BONUS once it works - remove Cron job. It's just unnecessary
// FIXME add an alias for the add-timestamp script.
// BONUS log file deletion script on cron job
// MEGA-BONUS some kinda classifier for genre!
✅ * work out which cookie/s are important for login
✅ * check which files have already been saved
✅ * download any new ones, with the correct file name
✅ * store their filenames / metadata
✅ * if an mp3, add the post title and notes to the audio file?
✅ * if an mp3, add the artwork?
✅ * if an mp3, add the year?
// * if an mp3, add the genre? Yeah but nah.
✅ * if on correct machine, move the files to the correct location. otherwise, scp the files to home server
✅ * add default album tag if not present
✅ delete temporary audio files after transfer?
✅ tag wav files! it can be done, apparently.

✅ BONUS log output of cron job on Ubuntu to a separate file, or email?
✅ BONUS log files with separate date stamps
✅ BONUS log entries with timestamps
✅ BONUS trigger Kodi audio library re-scan
✅ BONUS put job on an endpoint and download on email notification
✅ BONUS return 200 (or similar) once request to run job has been received, don't wait until job finishes to return response.


# id3v2 tagging tools and their limitations.
# Tagscanner - Windows only, but - no limitations on frame size, multiple frames allowed (uses c# library under the hood)
# id3v2 - limited to 254 chars. Possibly only one frame?
# eyeD3 - limited to 254 chars
# ffmpeg - can't write comment tags
# id3ed - can't write id3v2
# id3mtag (id3) - can't compile on macOS. Until now! https://endofhome.github.io/2019/01/11/compiling_id3mtag_for_macos.html
* id3 (available using apt-get install on Ubuntu - not the same as id3mtag)





























ALL cookies dumped:

[
  {
    "domain": ".patreon.com",
    "expirationDate": 1577918124.205221,
    "hostOnly": false,
    "httpOnly": true,
    "name": "__cfduid",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": true,
    "session": false,
    "storeId": "0",
    "value": "d66016687965a8ac8b996a79a578526631546382121",
    "id": 1
  },
  {
    "domain": ".patreon.com",
    "expirationDate": 1672612527,
    "hostOnly": false,
    "httpOnly": false,
    "name": "__ssid",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": false,
    "session": false,
    "storeId": "0",
    "value": "ec87c60c806e5542100ab2cebc7749e",
    "id": 2
  },
  {
    "domain": ".patreon.com",
    "expirationDate": 1546390054,
    "hostOnly": false,
    "httpOnly": false,
    "name": "_fbp",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": false,
    "session": false,
    "storeId": "0",
    "value": "fb.1.1546382125170.888673145",
    "id": 3
  },
  {
    "domain": ".patreon.com",
    "expirationDate": 1609454277,
    "hostOnly": false,
    "httpOnly": false,
    "name": "_ga",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": false,
    "session": false,
    "storeId": "0",
    "value": "GA1.2.975544414.1546382125",
    "id": 4
  },
  {
    "domain": ".patreon.com",
    "expirationDate": 1546468677,
    "hostOnly": false,
    "httpOnly": false,
    "name": "_gid",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": false,
    "session": false,
    "storeId": "0",
    "value": "GA1.2.1183779756.1546382125",
    "id": 5
  },
  {
    "domain": ".patreon.com",
    "expirationDate": 1861742277,
    "hostOnly": false,
    "httpOnly": false,
    "name": "amplitude_idpatreon.com",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": false,
    "session": false,
    "storeId": "0",
    "value": "eyJkZXZpY2VJZCI6IjU3MjgwNzMwLWFkNGQtNDU3OS05ZWExLWEzZjAwMzM4NzIwNCIsInVzZXJJZCI6IjE1NTAzNTg1Iiwib3B0T3V0IjpmYWxzZSwic2Vzc2lvbklkIjoxNTQ2MzgyMTI0ODk5LCJsYXN0RXZlbnRUaW1lIjoxNTQ2MzgyMjc3Mzk5LCJldmVudElkIjowLCJpZGVudGlmeUlkIjo1LCJzZXF1ZW5jZU51bWJlciI6NX0=",
    "id": 6
  },
  {
    "domain": ".patreon.com",
    "expirationDate": 2177102124.20526,
    "hostOnly": false,
    "httpOnly": false,
    "name": "patreon_device_id",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": false,
    "session": false,
    "storeId": "0",
    "value": "e8b6a1f1-4dfc-4119-a16d-dd663242361f",
    "id": 7
  },
  {
    "domain": ".patreon.com",
    "expirationDate": 1548974256.09805,
    "hostOnly": false,
    "httpOnly": true,
    "name": "session_id",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": true,
    "session": false,
    "storeId": "0",
    "value": "LmXZzux6Dxi5FX6ieSQU_xWB9SL7XANwdmjAImf60Mg",
    "id": 8
  },
  {
    "domain": "www.patreon.com",
    "expirationDate": 1555022258,
    "hostOnly": true,
    "httpOnly": false,
    "name": "_pendo_meta.84b39519-1e4c-483a-47ce-19bf730de8f7",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": false,
    "session": false,
    "storeId": "0",
    "value": "2665056331",
    "id": 9
  },
  {
    "domain": "www.patreon.com",
    "expirationDate": 1555022278,
    "hostOnly": true,
    "httpOnly": false,
    "name": "_pendo_visitorId.84b39519-1e4c-483a-47ce-19bf730de8f7",
    "path": "/",
    "sameSite": "no_restriction",
    "secure": true,
    "session": false,
    "storeId": "0",
    "value": "15503585",
    "id": 10
  }
]
